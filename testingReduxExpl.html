<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="minimum-scale=1.0, width=device-width, maximum-scale=1.0, user-scalable=no"/>
<meta charset="utf-8">
<script src="https://unpkg.com/prop-types/prop-types.js"></script>
<script src="https://unpkg.com/react@16/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
<script src="https://unpkg.com/redux@3.7.2/dist/redux.min.js"></script>
<script src="https://unpkg.com/node-uuid@1.4.7/uuid.js"></script>
<script src="https://unpkg.com/redux@3.7.2/dist/redux.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<title>Testing Area</title>
<style type='text/css'>
.hide {
	display: none 
}
</style>
</head>
<body>
<div id="react-container"></div>
<script type="text/babel">
const { Component } = React
const { v4 } = uuid
 const { createStore, combineReducers, compose, applyMiddleware } = Redux
const stateData = {
	"menu": [
		{
			"title": "Material", 
			"level": 0,
			"id": v4(),
			"parentItem":"Root",
			"childs": true,
			"show": true, 
		}, 
		{
			"title": "Spiritual", 
			"level": 0,
			"id": v4(),
			"parentItem":"Root",
			"childs": true,
			"show": true 				
		}, 
		{
			"title": "Career", 
			"level": -1,
			"id": v4(),
			"parentItem":"Material",
			"childs": true,
			"show": false,				 
		}, 
		{
			"title": "Private Life", 
			"level": -1,
			"id": v4(),
			"parentItem":"Material",	
			"childs": false,
			"show": false,				
		},
		{
			"title": "Education", 
			"level": -2,
			"id": v4(),
			"parentItem":"Career",	
			"childs": false,
			"show": false,				 
		}, 
		{
			"title": "Work", 
			"level": -2,
			"id": v4(),
			"parentItem":"Career",	
			"childs": false,
			"show": false,				 
		},
		{
			"title": "Creativity", 
			"level": -1,
			"id": v4(),
			"parentItem":"Spiritual",
			"childs": true,
			"show": false,				 
		}, 
		{
			"title": "Vlog", 
			"level": -2,
			"id": v4(),
			"parentItem":"Creativity",		
			"childs": false,
			"show": false,				 
		}, 		
	], 
	"notes": [
		{
			"note": "Here you can write your notes!",
			"id": v4(),
			"categoryNote": "default"
		}
	],
	"techVars": 
	{
		"showNote": false, 
		"category": null
	}		
}
//////////////REDUCERS//////////////////
const menuR = (state = {}, action) => {
	switch (action.type) {
		case "SHOW_ITEM_OR_NOT" :
		return {
				...state,
				show: action.showFlag
		}
		default:
		return state
	}	
}

const noteR = (state = {}, action) => {
	switch (action.type) {
		case "ADD_NOTE":
		return {  
			note: action.text,
			id: v4(),					
			categoryNote: action.categoryNote
		}              
		default :
		return state
	}
}

const notesR = (state = [], action) => {
	switch (action.type) {
		case "ADD_NOTE" :
		return [
			...state,
			noteR({}, action)					
		] 
		case "REMOVE_COLOR" :
		return state.filter(note => note.id !== action.id)
		default:
		return state
	}
}	 

const techVarsR = (state={}, action) => {
	switch (action.type) {
		case "ADD_TECHVARS" :
		return {
			showNote: action.showNote, 
			category: action.category
		}
		default: 
		return state				
	}
}
////////ACTION CREATORS////////
const setMenuFlag = (showFlag) => ({	 
	type: "SHOW_ITEM_OR_NOT", 
	show: showFlag	
})

const addNote = (text, title) =>
({
	type: "ADD_NOTE",
	id: v4(),
	text,
	categoryNote: title
})
const removeNote = id =>
({
	type: "REMOVE_COLOR",
	id
})
const addTechVars = (showNote, category) => 
({
	type: "ADD_TECHVARS",
	showNote, 
	category 
})
///////////////////STORE//////////////////////
const logger = store => next => action => {
    let result     
    result = next(action)
    console.log('next state', store.getState())     
    return result
}

const saver = store => next => action => {
    let result = next(action)
    localStorage['redux-store'] = JSON.stringify(store.getState())
    return result
}
localStorage.clear()
const storeFactory = (initialState=stateData) =>
applyMiddleware(logger, saver)(createStore)(
combineReducers({menuR, notesR, techVarsR}),
(localStorage['redux-store']) ?
JSON.parse(localStorage['redux-store']) :
stateData
)
const store = storeFactory()

/*/////////////////// App //////////////////*/
const App = ({store}) => {	
	
	// Menu fns//
	/*After a click Fn shows every Item that one level deeper and have a common parent and do have some childs */	
	
	const onClick = (title, id, level, childs, parentItem) => {	
		let item
		let { menu, notes, techVars } = store.getState()		
		const checkShowing = (item, level) => (item.level >= level-1 && item.parentItem == title) ? store.dispatch(setMenuFlag(true)) : store.dispatch(setMenuFlag(false))	
		menu.map( item => checkShowing(item, level) )
		const toggleShowNote = () => store.dispatch(addTechVars(true, title)) // fn that add fields to techVars
	   	const checkChilds = () => (childs) ? null : toggleShowNote()	// Fn that checks whether the menu item has childs
		checkChilds()		 
	}
	const {menu, notes, techVars} = store.getState()	 
	return (<div className="container-fluid mt-2">
		<div className="menu-list"> 					 
			<MenuItemList menu = {menu.filter(item => item.show==true)} 
			onClick={(title, id, level, childs, parentItem)=> onClick(title, id, level, childs, parentItem) }
		/>
		</div>	
		<div className="note-list" className={ (techVars.showNote) ? "show" : "hide" }> 
		<NoteList store={store} />
		<AddNoteForm store={store}/>		
		</div>	
		</div>
	 )
}
/////////////Fns that show Menu//////////////////////
const MenuItemList = ({menu=[], onClick=f=>f}) => 	
	<div className="menuItem">{menu.map( menuItem => 
		<MenuItem key={menuItem.id} {...menuItem}  
			onClick={(title, id, level, childs, parentItem)=> 
			onClick(title, id, level, childs, parentItem)}
	/>)}
	</div> 

const MenuItem = ({title, id, level, show, childs, parentItem, onClick=f=>f}) => 
	<div className={(show) ? "show" : "hide"} 
			onClick={()=> onClick(title, id, level, childs, parentItem)}>
			<p className="alert alert-primary m-1">{title} </p>
	</div>

//////////////////Fns that show, add, remove Notes ///////////////////////
const AddNoteForm = ({store}) => {
	let _message
	const submit = e => {
		e.preventDefault()
		store.dispatch( addNote(_message.value) )
		_message.value = ''
		_message.focus()
	}
	return (
	<form onSubmit={submit}>
	<textarea className="form-control ml-2 mr-2 " rows="2" ref={input => _message = input}/>
	<button className="btn btn-dark m-2 ">ADD</button>
	</form>
	)
}
/*//////////////////////////Render/////////////////////////*/	
const NoteList = ({store}) => {
	const {notes, techVars} = store.getState()
	return (<div> 
	{(notes.length === 0) ? <p>No Notes Listed. (Add a Note)</p> : notes.map(note => 
		<Note key={note.id} 
		{...note}  {...techVars}  
		onRemove={id=>store.dispatch( removeNote(id) )}/>			
		)		 
	}
	</div>)
}
const Note = ({note, id, categoryNote, category}) =>  {	 
	return (<div className={ (categoryNote==category || categoryNote=="default" ) ? "show" : "hide" } >					
		<button className="ml-2 mt-3 close" data-dismiss="toast" aria-label="Close" onClick={()=>onRemove(id)}>X</button><p></p>
		<div className="toast-body mb-0">{note}</div>
	</div>)
}

window.React = React
window.store = store
const render = () => ReactDOM.render(
<App store={store}/>,
document.getElementById('react-container')
) 
store.subscribe(render)
render()

</script>
</body>
</html>	